name: 'Build Binaries'

on:
  workflow_dispatch:
  schedule:
    - cron: '0 3 * * *'

permissions:
  contents: read
  pull-requests: read

# This allows a subsequently queued workflow run to interrupt previous runs
concurrency:
  group: '${{ github.workflow }} @ ${{ github.event.pull_request.head.label || github.head_ref || github.ref }}'
  cancel-in-progress: true

jobs:
  build-x86-64:
    runs-on: ubuntu-latest
    strategy:
      matrix:
        targets: [ linux ]
        architectures: [ x86_64 ]
    steps:
      - name: Checkout
        uses: actions/checkout@v3

      - name: Execute the script
        env:
          TARGET_BUILD: ${{ matrix.targets }}
          ARCH_BUILD: ${{ matrix.architectures }}
        run: |
          bash ./scripts/build-binaries.sh

  build-aarch64:
    runs-on: ubuntu-latest
    strategy:
      matrix:
        targets: [ linux ]
        architectures: [ aarch64 ]
    steps:
      - name: Checkout
        uses: actions/checkout@v3

      - name: Execute the script
        env:
          TARGET_BUILD: ${{ matrix.targets }}
          ARCH_BUILD: ${{ matrix.architectures }}
        run: |
          bash ./scripts/build-binaries.sh
